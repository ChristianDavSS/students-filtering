<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Titulaci칩n</title>
    <link rel="stylesheet" href="index.css">
    <!-- Librer칤a para gr치ficar datos -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- Librer칤a para hacer consultas al backend -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- Librer칤a para convertir la tabla en un archivo .xlsx -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <header>
    <div class="container">
        <div class="header-content">
            <h1 class="header-title">Consulta de Titulaci칩n UCOL</h1>
            <div class="header-actions">
                <button class="register-btn" id="registerBtn">
                    Registrar Nuevo Titulado
                </button>
                <button class="delete-btn" id="deleteBtn">
                    Eliminar Titulado
                </button>
            </div>
        </div>
    </div>
</header>

    <main class="container">

        <section class="search-section">
            <h2 class="search-title">B칰squeda Individual de Titulados</h2>
            <div class="search-container">
                <input 
                    type="text" 
                    class="search-input" 
                    id="searchInput"
                    placeholder="Ingresa tu b칰squeda..."
                >
                <select class="filter-select" id="filterSelect">
                    <option value="ncta">N칰mero de Cuenta</option>
                    <option value="nombre">Nombre del Estudiante</option>
                </select>
                <button class="search-btn" id="searchBtn">
                    Buscar
                </button>
            </div>
        </section>

        <section class="search-section">
            <h2 class="search-title">B칰squeda Gr치fica de Titulados</h2>
            <div class="search-container">
                <select class="filter-select" id="facultySelectChart">
                </select>
                <select class="filter-select" id="careerSelectChart">
                </select>
                <select class="filter-select" id="generationSelectChart">
                </select>
                <select class="filter-select" id="modalitySelectChart">
                </select>
                <button class="search-btn" id="searchBtnChart">
                    Generar Gr치fico
                </button>
                <button class="clear-btn" id="clearBtnChart">
                    Limpiar
                </button>
            </div>
        </section>

        <div class="results-section">
            <h3 class="results-title">Resultados de la b칰squeda</h3>
            <div class="results-actions">
                <button class="export-btn" id="exportBtn">
                    <i class="fas fa-file-excel"></i> Exportar a Excel
                </button>
            </div>
        </div>
            
            <div id="deleteModal" class="modal">
                <div class="modal-content">
                    <span class="close-btn">&times;</span>
                    <h2>Eliminar Titulado</h2>
                    <form id="deleteForm">
                        <p>Confirma el n칰mero de cuenta del titulado que deseas eliminar.</p>
                        <div class="form-group">
                            <label for="deleteNcta">N칰mero de Cuenta</label>
                            <input type="text" id="deleteNcta" minlength="8" maxlength="8" required>
                        </div>
                        <button type="submit" class="submit-btn delete">Eliminar</button>
                    </form>
                </div>
            </div>


            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Buscando datos...</p>
            </div>

            <div class="table-container">
                <table id="resultsTable">
                    <thead>
                        <tr>
                            <th>NUM. CUENTA</th>
                            <th>NOMBRE ESTUDIANTE</th>
                            <th>FACULTAD</th>
                            <th>CARRERA</th>
                            <th>GENERACI칍N</th>
                            <th>MODALIDAD TITULACI칍N</th>
                            <th>FECHA TITULACI칍N</th>
                            <th>SINODAL 1 (PRESIDENTE)</th>
                            <th>SINODAL 2 (SECRETARIO)</th>
                            <th>SINODAL 3 (VOCAL)</th>
                            <th>NOMBRE PROYECTO</th>
                            <th>ASESOR</th>
                            <th>CO-ASESOR</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        </tbody>
                </table>
            </div>

            <div class="no-results" id="noResults" style="display: none;">
                <p>No se encontraron resultados para tu b칰squeda.</p>
                <p>Intenta con otros t칠rminos o verifica que los datos sean correctos.</p>
            </div>
        </section>

        <section class="charts-section" id="chartsSection">
            <h3 class="charts-title">Estad칤sticas de Titulaci칩n</h3>
            
            <div class="loading" id="loadingChart">
                <div class="spinner"></div>
                <p>Generando gr치fico...</p>
            </div>

            <div class="chart-stats" id="chartStats" style="display: none;">
                <div class="stat-card">
                    <div class="stat-number" id="totalTitulados">0</div>
                    <div class="stat-label">Total</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="categoriasMostradas">0</div>
                    <div class="stat-label">Categor칤as</div>
                </div>
            </div>

            <div class="chart-type-selector" id="chartTypeSelector" style="display: none;">
                <button class="chart-type-btn active" data-type="bar">Barras</button>
                <button class="chart-type-btn" data-type="doughnut">Dona</button>
                <button class="chart-type-btn" data-type="line">L칤nea</button>
            </div>

            <div class="chart-wrapper" id="chartWrapper" style="display: none;">
                <h4 class="chart-title" id="chartTitle">Distribuci칩n</h4>
                <div class="chart-container">
                    <canvas id="chartCanvas"></canvas>
                </div>
            </div>

            <div class="no-chart-data" id="noChartData">
                <div style="font-size: 3em; opacity: 0.5; margin-bottom: 15px;">游늵</div>
                <p><strong>춰Genera tu primer gr치fico!</strong></p>
                <p>Selecciona una categor칤a y una opci칩n para ver las estad칤sticas</p>
            </div>
        </section>
    </main>

    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Registro de Nuevo Titulado</h2>
            <form id="registerForm">
                <div class="form-group">
                    <label for="regNcta">N칰mero de Cuenta</label>
                    <input type="text" id="regNcta" minlength="8" maxlength="8" required>
                </div>
                <div class="form-group">
                    <label for="regNombre">Nombre del Estudiante</label>
                    <input type="text" id="regNombre" required>
                </div>
                <div class="form-group">
                    <label for="regFaculty">Facultad</label>
                    <select id="regFaculty" required>
                    </select>
                </div>
                <div class="form-group">
                    <label for="regCareer">Carrera</label>
                    <select id="regCareer" required disabled>
                    </select>
                </div>
                <div class="form-group">
                    <label for="regGeneration">Generaci칩n</label>
                    <input type="text" id="regGeneration" placeholder="Ej. 2020-2025" minlength="9" maxlength="9" required>
                </div>
                <div class="form-group">
                    <label for="regModality">Modalidad de Titulaci칩n</label>
                    <select id="regModality" required>
                        <option value="">Selecciona una modalidad</option>
                        <optgroup label="Con asesor y co-asesor" id="conAsesores"></optgroup>
                        <optgroup label="Sin asesor y co-asesor" id="sinAsesores"></optgroup>
                    </select>
                </div>
                <div id="projectFields" class="form-group">
                    <div class="form-group" id="proyectoField">
                        <label for="regProyecto">Nombre del Proyecto</label>
                        <input type="text" id="regProyecto">
                    </div>
                    <div class="form-group" id="asesorField">
                        <label for="regAsesor">Asesor</label>
                        <select name="regAsesor" id="regAsesor"></select>
                    </div>
                    <div class="form-group" id="coasesorField">
                        <label for="regCoasesor">Co-asesor</label>
                        <select name="regCoasesor" id="regCoasesor"></select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="regFechaTitulacion">Fecha de Titulaci칩n</label>
                    <input type="date" id="regFechaTitulacion" required>
                </div>
                <div class="form-group">
                    <label for="regSinodal1">Sinodal 1 (Presidente)</label>
                    <select name="regSinodal1" id="regSinodalPresidente"></select>
                </div>
                <div class="form-group">
                    <label for="regSinodal2">Sinodal 2 (Secretario)</label>
                    <select name="regSinodal2" id="regSinodalSecretario"></select>
                </div>
                <div class="form-group">
                    <label for="regSinodal3">Sinodal 3 (Vocal)</label>
                    <select name="regSinodal3" id="regSinodalVocal"></select>
                </div>
                <button type="submit" class="submit-btn">Registrar</button>
            </form>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>Equipo Barragan Marquez Vega Sanchez Rivera | Sistema de Consulta de Titulaci칩n</p>
        </div>
    </footer>

    <script src="index.js"></script>
</body>
</html>